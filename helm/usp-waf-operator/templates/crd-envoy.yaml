# Generated by Fabric8 CRDGenerator, manual edits might get overwritten!
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: wafenvoyservices.usp.waf.envoy
spec:
  group: usp.waf.envoy
  names:
    kind: WafEnvoyService
    plural: wafenvoyservices
    singular: wafenvoyservice
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        properties:
          spec:
            properties:
              hostnames:
                description: App service access path
                items:
                  type: string
                type: array
              routes:
                description: App service listener port
                items:
                  properties:
                    auth:
                      description: Authentication
                      properties:
                        ref:
                          description: Reference to name of corresponding authentication
                            setting
                          type: string
                      type: object
                    match:
                      description: Matching criteria
                      properties:
                        path:
                          description: "Path (regex or prefix, depending on pathType,\
                            \ default is regex)"
                          type: string
                        pathType:
                          description: Path type
                          enum:
                          - REGEX
                          - PREFIX
                          type: string
                        filters:
                          description: Filters
                          properties:
                            rewrite:
                              description: Rewrite
                              properties:
                                url:
                                  properties:
                                    path:
                                      type: string
                                  type: object
                              type: object
                          type: object
                      type: object
                    backend:
                      description: Backend
                      properties:
                        port:
                          description: Host port
                          type: integer
                        address:
                          description: Host address
                          type: string
                      type: object
                  type: object
                type: array
              crs:
                description: CRS (ModSecurity OWASP Core Rule Set) settings
                properties:
                  parseJson:
                    description: Whether to parse JSON in body or not
                    type: boolean
                  responseRuleExceptions:
                    description: Response rule exceptions
                    items:
                      properties:
                        requestPartName:
                          description: Request part name (e.g. 'User-Agent')
                          type: string
                        regEx:
                          description: Whether the location is indicated as a regex
                            or not
                          type: boolean
                        ruleId:
                          description: Rule ID
                          type: integer
                        metadata:
                          description: Optional metadata (no impact on native config)
                          properties:
                            date:
                              description: "Optional: Date when the rule exception\
                                \ was added"
                              type: string
                            createdBy:
                              description: "Optional: By whom the rule exception was\
                                \ added"
                              type: string
                            comment:
                              description: "Optional: Comment why the rule exception\
                                \ was added"
                              type: string
                          type: object
                        requestPartType:
                          description: Request part type (e.g. REQUEST_HEADERS)
                          enum:
                          - PERF_PHASE3
                          - URLENCODED_ERROR
                          - STREAM_OUTPUT_BODY
                          - TX
                          - TIME_YEAR
                          - FULL_REQUEST
                          - PERF_COMBINED
                          - MATCHED_VAR
                          - QUERY_STRING
                          - USERAGENT_IP
                          - REQBODY_ERROR_MSG
                          - SCRIPT_FILENAME
                          - TIME_HOUR
                          - MULTIPART_NAME
                          - PERF_PHASE2
                          - MATCHED_VAR_NAME
                          - SERVER_PORT
                          - ARGS
                          - REQBODY_PROCESSOR
                          - REQUEST_BODY_LENGTH
                          - REQUEST_COOKIES
                          - REQUEST_COOKIES_NAMES
                          - REQUEST_HEADERS
                          - MULTIPART_CRLF_LF_LINES
                          - PERF_PHASE1
                          - REQUEST_BASENAME
                          - REQUEST_LINE
                          - PATH_INFO
                          - SCRIPT_BASENAME
                          - PERF_SWRITE
                          - SERVER_NAME
                          - ARGS_POST
                          - SCRIPT_GROUPNAME
                          - FULL_REQUEST_LENGTH
                          - TIME_MON
                          - USERID
                          - WEBAPPID
                          - MODSEC_BUILD
                          - REQUEST_HEADERS_NAMES
                          - TIME
                          - MULTIPART_STRICT_ERROR
                          - REMOTE_PORT
                          - REQBODY_ERROR
                          - AUTH_TYPE
                          - SESSION
                          - ARGS_POST_NAMES
                          - MULTIPART_FILENAME
                          - OUTBOUND_DATA_ERROR
                          - MATCHED_VARS_NAMES
                          - RESPONSE_CONTENT_LENGTH
                          - PERF_GC
                          - REMOTE_ADDR
                          - RESPONSE_CONTENT_TYPE
                          - FILES_NAMES
                          - REQUEST_URI
                          - SCRIPT_GID
                          - TIME_WDAY
                          - SCRIPT_USERNAME
                          - FILES_SIZES
                          - INBOUND_DATA_ERROR
                          - FILES_TMP_CONTENT
                          - DURATION
                          - ARGS_GET
                          - MULTIPART_PART_HEADERS
                          - PERF_LOGGING
                          - RESPONSE_PROTOCOL
                          - SCRIPT_UID
                          - REQUEST_URI_RAW
                          - REQUEST_FILENAME
                          - RESPONSE_HEADERS
                          - TIME_EPOCH
                          - ENV
                          - PERF_PHASE5
                          - SERVER_ADDR
                          - PERF_RULES
                          - HIGHEST_SEVERITY
                          - REMOTE_USER
                          - REQUEST_PROTOCOL
                          - TIME_DAY
                          - ARGS_NAMES
                          - XML
                          - RESPONSE_BODY
                          - FILES_TMPNAMES
                          - RESPONSE_HEADERS_NAMES
                          - SESSIONID
                          - TIME_MIN
                          - REMOTE_HOST
                          - REQUEST_BODY
                          - FILES_COMBINED_SIZE
                          - PERF_PHASE4
                          - PERF_SREAD
                          - RESPONSE_STATUS
                          - RULE
                          - GEO
                          - STREAM_INPUT_BODY
                          - SDBM_DELETE_ERROR
                          - WEBSERVER_ERROR_LOG
                          - SCRIPT_MODE
                          - MATCHED_VARS
                          - ARGS_COMBINED_SIZE
                          - FILES
                          - MULTIPART_UNMATCHED_BOUNDARY
                          - ARGS_GET_NAMES
                          - UNIQUE_ID
                          - REQUEST_METHOD
                          - TIME_SEC
                          type: string
                        location:
                          description: Location
                          type: string
                      type: object
                    type: array
                  enabledResponseRules:
                    description: Set of response rule classes (e.g. 951 or RESPONSE_951_DATA_LEAKAGES_SQL);
                      959 and 980 are always included
                    items:
                      type: integer
                    type: array
                  mode:
                    description: Mode (BLOCK|DETECT|DISABLED)
                    enum:
                    - DETECT
                    - BLOCK
                    - DISABLED
                    type: string
                  parseXml:
                    description: Whether to parse XML in body or not
                    type: boolean
                  securityLevel:
                    description: "Security level; possible values: 1 - 5; translates\
                      \ into the anomaly threshold"
                    type: integer
                  responseBodyLimit:
                    description: Response body limit in KB
                    type: integer
                  validateJson:
                    description: Whether to validate JSON in body or not
                    type: boolean
                  requestRuleExceptions:
                    description: Request rule exceptions
                    items:
                      properties:
                        requestPartName:
                          description: Request part name (e.g. 'User-Agent')
                          type: string
                        regEx:
                          description: Whether the location is indicated as a regex
                            or not
                          type: boolean
                        ruleId:
                          description: Rule ID
                          type: integer
                        metadata:
                          description: Optional metadata (no impact on native config)
                          properties:
                            date:
                              description: "Optional: Date when the rule exception\
                                \ was added"
                              type: string
                            createdBy:
                              description: "Optional: By whom the rule exception was\
                                \ added"
                              type: string
                            comment:
                              description: "Optional: Comment why the rule exception\
                                \ was added"
                              type: string
                          type: object
                        requestPartType:
                          description: Request part type (e.g. REQUEST_HEADERS)
                          enum:
                          - PERF_PHASE3
                          - URLENCODED_ERROR
                          - STREAM_OUTPUT_BODY
                          - TX
                          - TIME_YEAR
                          - FULL_REQUEST
                          - PERF_COMBINED
                          - MATCHED_VAR
                          - QUERY_STRING
                          - USERAGENT_IP
                          - REQBODY_ERROR_MSG
                          - SCRIPT_FILENAME
                          - TIME_HOUR
                          - MULTIPART_NAME
                          - PERF_PHASE2
                          - MATCHED_VAR_NAME
                          - SERVER_PORT
                          - ARGS
                          - REQBODY_PROCESSOR
                          - REQUEST_BODY_LENGTH
                          - REQUEST_COOKIES
                          - REQUEST_COOKIES_NAMES
                          - REQUEST_HEADERS
                          - MULTIPART_CRLF_LF_LINES
                          - PERF_PHASE1
                          - REQUEST_BASENAME
                          - REQUEST_LINE
                          - PATH_INFO
                          - SCRIPT_BASENAME
                          - PERF_SWRITE
                          - SERVER_NAME
                          - ARGS_POST
                          - SCRIPT_GROUPNAME
                          - FULL_REQUEST_LENGTH
                          - TIME_MON
                          - USERID
                          - WEBAPPID
                          - MODSEC_BUILD
                          - REQUEST_HEADERS_NAMES
                          - TIME
                          - MULTIPART_STRICT_ERROR
                          - REMOTE_PORT
                          - REQBODY_ERROR
                          - AUTH_TYPE
                          - SESSION
                          - ARGS_POST_NAMES
                          - MULTIPART_FILENAME
                          - OUTBOUND_DATA_ERROR
                          - MATCHED_VARS_NAMES
                          - RESPONSE_CONTENT_LENGTH
                          - PERF_GC
                          - REMOTE_ADDR
                          - RESPONSE_CONTENT_TYPE
                          - FILES_NAMES
                          - REQUEST_URI
                          - SCRIPT_GID
                          - TIME_WDAY
                          - SCRIPT_USERNAME
                          - FILES_SIZES
                          - INBOUND_DATA_ERROR
                          - FILES_TMP_CONTENT
                          - DURATION
                          - ARGS_GET
                          - MULTIPART_PART_HEADERS
                          - PERF_LOGGING
                          - RESPONSE_PROTOCOL
                          - SCRIPT_UID
                          - REQUEST_URI_RAW
                          - REQUEST_FILENAME
                          - RESPONSE_HEADERS
                          - TIME_EPOCH
                          - ENV
                          - PERF_PHASE5
                          - SERVER_ADDR
                          - PERF_RULES
                          - HIGHEST_SEVERITY
                          - REMOTE_USER
                          - REQUEST_PROTOCOL
                          - TIME_DAY
                          - ARGS_NAMES
                          - XML
                          - RESPONSE_BODY
                          - FILES_TMPNAMES
                          - RESPONSE_HEADERS_NAMES
                          - SESSIONID
                          - TIME_MIN
                          - REMOTE_HOST
                          - REQUEST_BODY
                          - FILES_COMBINED_SIZE
                          - PERF_PHASE4
                          - PERF_SREAD
                          - RESPONSE_STATUS
                          - RULE
                          - GEO
                          - STREAM_INPUT_BODY
                          - SDBM_DELETE_ERROR
                          - WEBSERVER_ERROR_LOG
                          - SCRIPT_MODE
                          - MATCHED_VARS
                          - ARGS_COMBINED_SIZE
                          - FILES
                          - MULTIPART_UNMATCHED_BOUNDARY
                          - ARGS_GET_NAMES
                          - UNIQUE_ID
                          - REQUEST_METHOD
                          - TIME_SEC
                          type: string
                        location:
                          description: Location
                          type: string
                      type: object
                    type: array
                  requestBodyLimit:
                    description: Request body limit in KB
                    type: integer
                  enabledRequestRules:
                    description: Set of request rule classes (e.g. 941 or REQUEST_941_APPLICATION_ATTACK_XSS);
                      901 and 949 are always included
                    items:
                      type: integer
                    type: array
                  requestBodyAccess:
                    description: Request body access or not
                    type: boolean
                  paranoiaLevel:
                    description: "Paranoia level; possible values: 1 - 4"
                    type: integer
                type: object
              websocket:
                description: Allow websocket
                type: boolean
              authentication:
                description: Authentication
                items:
                  properties:
                    audience:
                      description: Optional list of accepted JWT audiences; if none
                        is specified the JWT is not matched against the audience list
                      items:
                        type: string
                      type: array
                    credentials:
                      description: OIDC credentials (client_id and client_secret)
                      properties:
                        hmacSecret:
                          description: HMAC secret by value (exclusive with hmacSecret)
                          type: string
                        hmacSecretRef:
                          description: HMAC secret via reference to Kubernetes secret
                            (exclusive with hmacSecret)
                          type: string
                        clientSecret:
                          description: OIDC client_secret by value (exclusive with
                            clientSecretRef)
                          type: string
                        clientId:
                          description: OIDC client_id
                          type: string
                        clientSecretRef:
                          description: OIDC client_secret via reference to Kubernetes
                            secret (exclusive with clientSecret)
                          type: string
                      type: object
                    scopes:
                      description: List of scopes to be claimed in the authorization
                        request
                      items:
                        type: string
                      type: array
                    tokenEndpointAuthType:
                      description: "How to pass the client_id to the OP (default is\
                        \ QUERY for query parameter, BASIC for basic auth)"
                      enum:
                      - QUERY
                      - BASIC
                      type: string
                    jwksSymmetricKey:
                      description: "Only allowed if jwksEndpoint is not defined, defines\
                        \ a symmetric key as JWKS (in envoy 'local_jwks')"
                      type: string
                    backend:
                      description: Settings for propagation to backend
                      properties:
                        jwtProcessingEndpoint:
                          description: URL which allows to modify the JWT
                          type: string
                        jwtClaimToHeader:
                          description: Translations of JWT claims to HTTP headers
                          items:
                            properties:
                              claim:
                                description: Claim to set as header
                                type: string
                              headerName:
                                description: Name of the header to set to the claim
                                type: string
                            type: object
                          type: array
                        forwardJwt:
                          description: If true (default) the JWT is forwarded to upstream
                            server
                          type: boolean
                      type: object
                    authorizationEndpoint:
                      description: OIDC OP authorization endpoint URL
                      type: string
                    tokenEndpoint:
                      description: OIDC OP token endpoint URL
                      type: string
                    name:
                      description: Name to reference in routes
                      type: string
                    issuer:
                      description: OIDC OP issuer
                      type: string
                    jwksEndpoint:
                      description: "OIDC JWKS endpoint URL, offers credentials to\
                        \ verify JWTs"
                      type: string
                  type: object
                type: array
            type: object
          status:
            properties:
              status:
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
